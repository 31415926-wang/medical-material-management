import{d as oe,o as ie,a as me,r as S,b as G,w as ae,c as U,e as le,f as ve,g as o,h as te,n as I,i as z,u as l,t as se,T as ge,j as fe,k as we,l as h,m as T,p as ne,q as xe,s as _e,v as M,x as ye,y as Xe,z as be,A as Te,B as Se,_ as Ye}from"./index-5a424909.js";const Be="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAELklEQVRYR+2YW2wUZRTH//9vtlCoF9IoIklT3PqgPGi326hoetuaGEhIr9SgCYkkgt2WGOQVCca+GavWdr0GjD4YhG3RB3hply1LQA1tEQIxEXapGI2pEkys9LIzx2ylYWfY6e5sF0oi+7hzzvl+3/9855xvhrjNf7zN+XAHcL4Z+n8o6JWTeYt++W25S596AIZy6TB+n3yo+Nchlk8vmIIVowdXU9c3Q1gDSilBlQwjgBAYFGDvdF58/4milqvZwDpOcXWsb5Uh8hmBqkwXFMhlCN8aX5LXNbRy/T+Z+iXsHAFWRXs3QGQPyLucLDJrK5DgUXdTsxPfjAEro8E3Ce50EtxsKxPTwCPH3U2jTmJkBJgWTnAMxDeGMEoa0xQ+LJQnCD4HYFkCyAC3RdwN3U7gMkpxRTTYrMD91sCJIgCxV5R6O1Jcfy7VwonqLoj9/CqB2kF341qncGkBvRe+ureAWpRgoalCBecMFzcdK24YymZRJz5zprgq1tsJwXYL3CVZGvdGHmwZc7JQtra2gE+f712ep2QUYP714DJhaJrXLqXZQszlZwtYdSHoB9ljVk/ePVrSZFL0ZkAlxzQBVseCT8WhZhRThtFB8plk9Zi/qCi8cv0fNxvKFrDy4oF11NXXIFy2EII4iBcG3Y03VLZT8OqRd5aFPduvOEpxRayvXolxAKB2g6NgEhobBlc1HHYKY7WvHf5wtVAPgegIlbbZ9seUZ7AyFnwewi9pGoUyDmhrB931kfnC1ZwOeKlLP8GZJi6QLSFP2yep4toXSbT3ZQAfX3O6omt8Nhd9r/aHQAUMOQywYBZo5uZD2ThQ2rbPCjlnH6yI9rUryE5DU75ctJaake46Be4DuDjF8dFBNA94/AdtiySVxIlpMlTS8td801o70vMigM9huTda2lhcKHVHPO2HZv/P6LIwX7hk/+qzPSvUJGMkrg8AQYTkroRdXMlE+HH/twsG6BsOdJHYZlaO/lBZ6weOiiSXqs3Gqj0TeAxx+T75DIpgwjC0onD51pQD4JaluPrkR/cpFT9DcoVp84LOgTL/DjtBbglgou+puHwB8lEznPxJw1XSX77VtgizBvQNBw4RMqB7xt4Lc3c8lQKJaQHoO4R8ydz0/7MWoCXk8c85MrMC9J3qaafw/WtQlwXST+F3BnAeYB4obgJ1BJIuG+YtiKAjVOZ/Pd1ZdwzoG+4uBtSPpjaRbhXLcwF3hzytb2TilgVgT5BkYybBrTYC+Rvg5nRpdTRJrIs8+VPXPQXj2i4ItxC4O2NQQUQnN4U9rRcz9nH64p4ceM2lziX5Y4s3KHCdUHwE77ecMkMEp6BwhIa2Z6DslZRvfulgHafYLuCas58WLp2aLCFUga70qxOFU6dPFL2W1feYeaU43Y5z/TxnCuYabMEuC043ckdBp4pZ7f8FE5psOI1g6fwAAAAASUVORK5CYII=",Ce=["width","height"],Ie=["width","height"],Me=["width","height"],Ae=o("div",{class:"loading-gif_"},[o("span"),o("span"),o("span"),o("span"),o("span")],-1),ze=[Ae],ke={class:"auth-control_"},He={class:"range-text"},Re=o("div",null,null,-1),We=o("div",null,null,-1),Le=o("div",null,null,-1),De=[Re,We,Le],Pe=oe({__name:"App",props:{type:{type:String,default:"modal"},canvasWidth:{type:Number,default:310},canvasHeight:{type:Number,default:160},show:{type:Boolean,default:!1},puzzleScale:{type:Number,default:1},sliderSize:{type:Number,default:50},range:{type:Number,default:10},zIndex:{type:Number,default:999},imgs:{type:Array,default:null},successText:{type:String,default:"验证通过！"},failText:{type:String,default:"验证失败，请重试"},sliderText:{type:String,default:"拖动滑块完成拼图"},className:{type:String,default:""}},emits:["success","fail","close","reset"],setup(r,{expose:b,emit:Y}){const s=r;ie(()=>{document.addEventListener("mousemove",C,!1),document.addEventListener("mouseup",x,!1),document.addEventListener("touchmove",C,{passive:!1}),document.addEventListener("touchend",x,!1),a.isInside=s.type==="inside",s.show&&(!a.isInside&&document.body.classList.add("vue-puzzle-overflow"),R())}),me(()=>{a.timer1&&clearTimeout(a.timer1),document.removeEventListener("mousemove",C,!1),document.removeEventListener("mouseup",x,!1),document.removeEventListener("touchmove",C),document.removeEventListener("touchend",x,!1)});const V=S(),W=S(),k=S(),B=S(),a=G({isInside:!1,mouseDown:!1,startWidth:50,startX:0,newX:0,pinX:0,pinY:0,loading:!1,isCanSlide:!1,error:!1,infoBoxShow:!1,infoText:"",infoBoxFail:!1,timer1:void 0,closeDown:!1,isSuccess:!1,imgIndex:-1,isSubmting:!1});ae(()=>s.show,t=>{t?(!a.isInside&&document.body.classList.add("vue-puzzle-overflow"),R()):(a.isSubmting=!1,a.isSuccess=!1,a.infoBoxShow=!1,document.body.classList.remove("vue-puzzle-overflow"))}),ae(()=>s.type,t=>{t==="inside"?(a.isInside=!0,document.body.classList.remove("vue-puzzle-overflow")):a.isInside=!1});const v=U(()=>{const t=a.startWidth+a.newX-a.startX;return t<u.value?u.value:t>s.canvasWidth?s.canvasWidth:t}),d=U(()=>Math.round(Math.max(Math.min(s.puzzleScale,2),.2)*52.5+6)),u=U(()=>Math.max(Math.min(Math.round(s.sliderSize),Math.round(s.canvasWidth*.5)),10)),Z=U(()=>s.zIndex!==999?`z-index:${s.zIndex}`:""),Q=()=>{!a.mouseDown&&!a.isSubmting&&(a.timer1&&clearTimeout(a.timer1),Y("close"))},H=()=>{a.isInside||(a.closeDown=!0)},p=()=>{a.closeDown&&Q(),a.closeDown=!1},w=t=>{var n;a.isCanSlide&&(a.mouseDown=!0,a.startWidth=((n=V.value)==null?void 0:n.clientWidth)||0,a.newX=t.clientX||t.changedTouches[0].clientX,a.startX=t.clientX||t.changedTouches[0].clientX)},C=t=>{a.mouseDown&&(t.preventDefault(),a.newX=t.clientX||t.changedTouches[0].clientX)},x=()=>{a.mouseDown&&(a.mouseDown=!1,de())},L=(t=!1)=>{var n;if(a.loading&&!t)return;a.loading=!0,a.isCanSlide=!1;const c=W.value,m=k.value,g=B.value,e=c==null?void 0:c.getContext("2d",{willReadFrequently:!0}),y=m==null?void 0:m.getContext("2d"),D=g==null?void 0:g.getContext("2d");if(!e||!y||!D){console.error("not found ctx / ctx2 / ctx3");return}const ue=navigator.userAgent.indexOf("Firefox")>=0&&navigator.userAgent.indexOf("Windows")>=0,X=document.createElement("img");if(e.fillStyle="rgba(255,255,255,1)",D.fillStyle="rgba(255,255,255,1)",e.clearRect(0,0,s.canvasWidth,s.canvasHeight),y.clearRect(0,0,s.canvasWidth,s.canvasHeight),a.pinX=i(d.value+20,s.canvasWidth-d.value-10),a.pinY=i(20,s.canvasHeight-d.value-10),X.crossOrigin="anonymous",X.onload=()=>{const[f,q,$,J]=N(X),j=Math.random(),K=Math.random(),ee=Math.random(),he=Math.random(),P=j<.33?-1:j<.66?0:1,O=K<.33?-1:K<.66?0:1,E=ee<.33?-1:ee<.66?0:1,F=he<.6?1:0;e.save(),A(e,P,O,E,F),e.closePath(),ue?(e.clip(),e.save(),e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowColor="#000",e.shadowBlur=3,e.fill(),e.restore()):(e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowColor="#000",e.shadowBlur=3,e.fill(),e.clip()),e.drawImage(X,f,q,$,J),D.fillRect(0,0,s.canvasWidth,s.canvasHeight),D.drawImage(X,f,q,$,J),e.globalCompositeOperation="source-atop",A(e,P,O,E,F),e.arc(a.pinX+Math.ceil(d.value/2),a.pinY+Math.ceil(d.value/2),d.value*1.2,0,Math.PI*2,!0),e.closePath(),e.shadowColor="rgba(255, 255, 255, .8)",e.shadowOffsetX=-1,e.shadowOffsetY=-1,e.shadowBlur=Math.min(Math.ceil(8*s.puzzleScale),12),e.fillStyle="#ffffaa",e.fill();const pe=e.getImageData(a.pinX-3,a.pinY-20,a.pinX+d.value+5,a.pinY+d.value+5);y.putImageData(pe,0,a.pinY-20),e.restore(),e.clearRect(0,0,s.canvasWidth,s.canvasHeight),e.save(),A(e,P,O,E,F),e.globalAlpha=.8,e.fillStyle="#ffffff",e.fill(),e.restore(),e.save(),e.globalCompositeOperation="source-atop",A(e,P,O,E,F),e.arc(a.pinX+Math.ceil(d.value/2),a.pinY+Math.ceil(d.value/2),d.value*1.2,0,Math.PI*2,!0),e.shadowColor="#000",e.shadowOffsetX=2,e.shadowOffsetY=2,e.shadowBlur=16,e.fill(),e.restore(),e.save(),e.globalCompositeOperation="destination-over",e.drawImage(X,f,q,$,J),e.restore(),a.loading=!1,a.isCanSlide=!0},X.onerror=()=>{L(!0)},!t&&(n=s.imgs)!=null&&n.length){let f=i(0,s.imgs.length-1);f===a.imgIndex&&(f===s.imgs.length-1?f=0:f++),a.imgIndex=f,X.src=s.imgs[f]}else X.src=_()},i=(t,n)=>Math.ceil(Math.random()*(n-t)+t),N=t=>{const n=t.width/t.height,c=s.canvasWidth/s.canvasHeight;let m=0,g=0,e=0,y=0;return n>c?(y=s.canvasHeight,e=n*y,g=0,m=(s.canvasWidth-e)/2):(e=s.canvasWidth,y=e/n,m=0,g=(s.canvasHeight-y)/2),[m,g,e,y]},A=(t,n,c,m,g)=>{const e=Math.ceil(15*s.puzzleScale);t.beginPath(),t.moveTo(a.pinX,a.pinY),t.lineTo(a.pinX+e,a.pinY),t.arcTo(a.pinX+e,a.pinY+n*e/2,a.pinX+e+e/2,a.pinY+n*e/2,e/2),t.arcTo(a.pinX+e+e,a.pinY+n*e/2,a.pinX+e+e,a.pinY,e/2),t.lineTo(a.pinX+e+e+e,a.pinY),t.lineTo(a.pinX+e+e+e,a.pinY+e),t.arcTo(a.pinX+e+e+e+c*e/2,a.pinY+e,a.pinX+e+e+e+c*e/2,a.pinY+e+e/2,e/2),t.arcTo(a.pinX+e+e+e+c*e/2,a.pinY+e+e,a.pinX+e+e+e,a.pinY+e+e,e/2),t.lineTo(a.pinX+e+e+e,a.pinY+e+e+e),t.lineTo(a.pinX+e+e,a.pinY+e+e+e),t.arcTo(a.pinX+e+e,a.pinY+e+e+e+m*e/2,a.pinX+e+e/2,a.pinY+e+e+e+m*e/2,e/2),t.arcTo(a.pinX+e,a.pinY+e+e+e+m*e/2,a.pinX+e,a.pinY+e+e+e,e/2),t.lineTo(a.pinX,a.pinY+e+e+e),t.lineTo(a.pinX,a.pinY+e+e),t.arcTo(a.pinX+g*e/2,a.pinY+e+e,a.pinX+g*e/2,a.pinY+e+e/2,e/2),t.arcTo(a.pinX+g*e/2,a.pinY+e,a.pinX,a.pinY+e,e/2),t.lineTo(a.pinX,a.pinY)},_=()=>{const t=document.createElement("canvas"),n=t.getContext("2d");if(!n)return console.error("not found ctx"),"";t.width=s.canvasWidth,t.height=s.canvasHeight,n.fillStyle=`rgb(${i(100,255)},${i(100,255)},${i(100,255)})`,n.fillRect(0,0,s.canvasWidth,s.canvasHeight);for(let c=0;c<12;c++)if(n.fillStyle=`rgb(${i(100,255)},${i(100,255)},${i(100,255)})`,n.strokeStyle=`rgb(${i(100,255)},${i(100,255)},${i(100,255)})`,i(0,2)>1)n.save(),n.rotate(i(-90,90)*Math.PI/180),n.fillRect(i(-20,t.width-20),i(-20,t.height-20),i(10,t.width/2+10),i(10,t.height/2+10)),n.restore();else{n.beginPath();const m=i(-Math.PI,Math.PI);n.arc(i(0,t.width),i(0,t.height),i(10,t.height/2+10),m,m+Math.PI*1.5),n.closePath(),n.fill()}return t.toDataURL("image/png")},de=()=>{a.isSubmting=!0;const t=Math.abs(a.pinX-(v.value-u.value)+(d.value-u.value)*((v.value-u.value)/(s.canvasWidth-u.value))-3);t<s.range?(a.infoText=s.successText,a.infoBoxFail=!1,a.infoBoxShow=!0,a.isCanSlide=!1,a.isSuccess=!0,a.timer1&&clearTimeout(a.timer1),a.timer1=setTimeout(()=>{a.isSubmting=!1,Y("success",t)},800)):(a.infoText=s.failText,a.infoBoxFail=!0,a.infoBoxShow=!0,a.isCanSlide=!1,Y("fail",t),a.timer1&&clearTimeout(a.timer1),a.timer1=setTimeout(()=>{a.isSubmting=!1,R()},800))},ce=()=>{a.infoBoxFail=!1,a.infoBoxShow=!1,a.isCanSlide=!1,a.isSuccess=!1,a.startWidth=u.value,a.startX=0,a.newX=0},R=t=>{a.isSubmting||(ce(),L(),t&&Y("reset"))};return b({reset:R}),(t,n)=>(le(),ve(ge,{to:"body",disabled:a.isInside},[o("div",{class:z(["vue-puzzle-vcode",{inside_:a.isInside,show_:r.show},r.className]),style:I(l(Z)),onMousedown:H,onMouseup:p,onTouchstart:H,onTouchend:p},[o("div",{class:"vue-auth-box_",onMousedown:n[3]||(n[3]=te(()=>{},["stop"])),onTouchstart:n[4]||(n[4]=te(()=>{},["stop"]))},[o("div",{class:"auth-body_",style:I(`width:${r.canvasWidth}px;height: ${r.canvasHeight}px`)},[o("canvas",{ref_key:"canvas1",ref:W,class:"auth-canvas1_",width:r.canvasWidth,height:r.canvasHeight},null,8,Ce),o("canvas",{ref_key:"canvas3",ref:B,class:z(["auth-canvas3_",{show:a.isSuccess}]),width:r.canvasWidth,height:r.canvasHeight},null,10,Ie),o("canvas",{ref_key:"canvas2",ref:k,class:"auth-canvas2_",width:l(d),height:r.canvasHeight,style:I(`width:${l(d)}px;height:${r.canvasHeight}px;transform:translateX(${l(v)-l(u)-(l(d)-l(u))*((l(v)-l(u))/(r.canvasWidth-l(u)))}px)`)},null,12,Me),o("div",{class:z(["loading-box_",{hide_:!a.loading}])},ze,2),o("div",{class:z(["info-box_",{show:a.infoBoxShow},{fail:a.infoBoxFail}])},se(a.infoText),3),o("div",{class:z(["flash_",{show:a.isSuccess}]),style:I(`transform: translateX(${a.isSuccess?`${r.canvasWidth+r.canvasHeight*.578}px`:`-${r.canvasHeight*.578}px`}) skew(-30deg, 0);`)},null,6),o("img",{class:"reset_",onClick:n[0]||(n[0]=c=>R(!0)),src:Be})],4),o("div",ke,[o("div",{class:"range-box",style:I(`height:${l(u)}px;width:${r.canvasWidth}px`)},[o("div",He,se(r.sliderText),1),o("div",{class:"range-slider",ref_key:"rangeSlider",ref:V,style:I(`width:${l(v)}px`)},[o("div",{class:z(["range-btn",{isDown:a.mouseDown}]),style:I(`width:${l(u)}px`),onMousedown:n[1]||(n[1]=c=>w(c)),onTouchstart:n[2]||(n[2]=c=>w(c))},De,38)],4)],4)])],32)],38)],8,["disabled"]))}}),re=r=>(Te("data-v-1d1ad457"),r=r(),Se(),r),Oe={class:"login_box"},Ee={class:"login_out_box flex-center-x-y"},Fe={class:"login_from"},Ue=re(()=>o("div",{class:"title"},"Hello",-1)),Ve=re(()=>o("div",{class:"title_desc"},"欢迎来到疫情物资管理系统",-1)),Ze=oe({__name:"index",setup(r){let b=fe(),Y=xe(),s=_e();const W=G({username:[{required:!0,message:"请输入账号",trigger:["blur","change"]},{min:1,max:15,message:"账号长度应为1-15位",trigger:["blur","change"]}],password:[{required:!0,message:"请输入密码",trigger:["blur","change"]},{trigger:["blur","change"],validator:(H,p,w)=>{p.length>=6?w():w(new Error("密码长度至少需6位"))}}]});let k=S(),B=S(!1),a=G({username:"admin",password:"123456"}),v=S(!1),d=S(!1);ie(()=>{Object.keys(b.rememberUser).length!=0&&(a.username=b.rememberUser.username,a.password=b.rememberUser.password,v.value=!0)});const u=()=>{d.value=!1,Q()},Z=async()=>{await k.value.validate(),d.value=!0},Q=async()=>{B.value=!0;try{await b.userLogin(a),v.value?b.addRememberUser(a.username,a.password):b.resetRememberUser(),B.value=!1,s.query.wantToPath?Y.push({path:""+s.query.wantToPath}):Y.push({path:"/home"})}catch{B.value=!1}};return(H,p)=>{const w=M("el-col"),C=M("el-input"),x=M("el-form-item"),L=M("el-checkbox"),i=M("el-button"),N=M("el-form"),A=M("el-row");return le(),we("div",Oe,[h(A,{class:"el_row"},{default:T(()=>[h(w,{xs:0,sm:11}),h(w,{xs:24,sm:12},{default:T(()=>[o("div",Ee,[o("div",Fe,[Ue,Ve,h(N,{model:l(a),"label-width":"0px",rules:W,ref_key:"formRef",ref:k,"status-icon":""},{default:T(()=>[h(x,{label:"",prop:"username"},{default:T(()=>[h(C,{modelValue:l(a).username,"onUpdate:modelValue":p[0]||(p[0]=_=>l(a).username=_),"prefix-icon":l(ye),placeholder:"请输入账号"},null,8,["modelValue","prefix-icon"])]),_:1}),h(x,{label:"",prop:"password"},{default:T(()=>[h(C,{modelValue:l(a).password,"onUpdate:modelValue":p[1]||(p[1]=_=>l(a).password=_),"prefix-icon":l(Xe),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue","prefix-icon"])]),_:1}),h(x,null,{default:T(()=>[h(L,{modelValue:l(v),"onUpdate:modelValue":p[2]||(p[2]=_=>ne(v)?v.value=_:v=_),class:"login_check",label:"记住密码"},null,8,["modelValue"])]),_:1}),h(x,null,{default:T(()=>[h(i,{type:"primary",class:"login_btn",loading:l(B),onClick:Z},{default:T(()=>[be("登录")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])])])]),_:1}),h(w,{xs:0,sm:1})]),_:1}),h(l(Pe),{show:l(d),onSuccess:u,onClose:p[3]||(p[3]=_=>ne(d)?d.value=!1:d=!1)},null,8,["show"])])}}});const Ne=Ye(Ze,[["__scopeId","data-v-1d1ad457"]]);export{Ne as default};
